{% extends "dashboard/index.html.twig" %}

{% block title %}Meetings - ReadTheVoice
{% endblock %}

{% block dashboardContent %}
	<div class="p-3">
		{% if meetings is defined and meetings is not empty %}
			<div class="d-flex flex-row align-items-center">
				<h1>Meetings</h1>
				<a type="button" class="btn btn-primary ms-auto" href="{{ path("app_dashboard_create_transcription") }}">Create meeting</a>
			</div>
		{% else %}
			<h1>Transcriptions</h1>
		{% endif %}
		<div class="d-flex flex-column w-100 h-100 p-3">

			{% for message in app.flashes("meetings_success") %}
				<div class="alert alert-success alert-dismissible fade show" role="alert">
					{{ message }}
					<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
				</div>
			{% endfor %}

			{% for message in app.flashes("meetings_error") %}
				<div class="alert alert-danger alert-dismissible fade show" role="alert">
					{{ message }}
					<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
				</div>
			{% endfor %}

			{% if meetings is defined and meetings is not empty %}
				<div class="d-flew row row-cols-1 row-cols-lg-4 row-cols-md-3 row-cols-sm-2 g-4 justify-content-center">
					{% for meeting in meetings %}
						<div class="d-flex col align-items-stretch">
							<div class="card card-transcription-list">

								<div class="card-body {{ meeting.state == 0 ? 'state-0' : (meeting.state == 1 ? 'state-1' : 'state-2') }}">
									<div class="d-flex flex-row align-items-center justify-content-center mb-2">

										<h5 class="card-title">{{ meeting.name }}</h5>
										<div class="d-flex flex-row gap-2 ms-auto">
											<button class="d-flex btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#{{ meeting.id|trim('1234567890', 'left')|lower }}-qrcode-modal">
												<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-qr-code" viewbox="0 0 16 16">
													<path d="M2 2h2v2H2z"/>
													<path d="M6 0v6H0V0zM5 1H1v4h4zM4 12H2v2h2z"/>
													<path d="M6 10v6H0v-6zm-5 1v4h4v-4zm11-9h2v2h-2z"/>
													<path d="M10 0v6h6V0zm5 1v4h-4V1zM8 1V0h1v2H8v2H7V1zm0 5V4h1v2zM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8zm0 0v1H2V8H1v1H0V7h3v1zm10 1h-1V7h1zm-1 0h-1v2h2v-1h-1zm-4 0h2v1h-1v1h-1zm2 3v-1h-1v1h-1v1H9v1h3v-2zm0 0h3v1h-2v1h-1zm-4-1v1h1v-2H7v1z"/>
													<path d="M7 12h1v3h4v1H7zm9 2v2h-3v-1h2v-1z"/>
												</svg>
											</button>
											<a class="d-flex btn btn-light btn-sm" href="#">
												<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewbox="0 0 16 16">
													<path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.5.5 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11z"/>
												</svg>
											</a>
											<button class="d-flex btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#{{ meeting.id|trim('1234567890', 'left')|lower }}-delete-modal">
												<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill" viewbox="0 0 16 16">
													<path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"/>
												</svg>
											</button>
										</div>
									</div>
									{% if meeting.state == 0 %}
										<h6 class="card-subtitle mb-2 text-body-secondary">Scheduled for
											{{ meeting.scheduledDateString }}</h6>
									{% elseif meeting.state == 1 %}
										<h6 class="card-subtitle mb-2 text-body-secondary">Started</h6>
									{% elseif meeting.state == 2 %}
										<h6 class="card-subtitle mb-2 text-body-secondary">Ended on
											{{ meeting.endDateString }}</h6>
									{% endif %}
									<p class="card-text">{{ meeting.description }}</p>
									<a href="{{ path('app_dashboard_transcriptions_get', {transcriptionId: meeting.id}) }}" class="btn btn-primary w-100">
										View meeting
									</a>

									<div align="center"></div>
								</div>
							</div>
							<div class="modal fade" tabindex="-1" id="{{ meeting.id|trim('1234567890', 'left')|lower }}-qrcode-modal">
								<div class="modal-dialog" role="document">
									<div class="modal-content rounded-3 shadow">
										<div class="modal-body p-4 text-center">
											<h5 class="mb-0" id="{{ meeting.id|trim('1234567890', 'left')|lower }}-qrcode-modal">QR Code for
												{{ meeting.name }}</h5>
											<div id="qrcode-{{ meeting.id|trim('1234567890', 'left')|lower }}" class="d-flex flex-column">
												<img src="{{ qr_code_url('readthevoice://'~ meeting.id, 'readthevoice') }}"/>
												<a class="btn btn-primary" onclick="this.href = document.querySelector('#qrcode-{{ meeting.id|trim('1234567890', 'left')|lower }} img').src;" type="button" download="readthevoice-{{ meeting.name }}.png">
													<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewbox="0 0 16 16">
														<path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"/>
														<path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"/>
													</svg>
													Download QR Code</a>
											</div>
										</div>
										<div class="modal-footer flex-nowrap p-0 justify-content-center">
											<button type="button" class="btn btn-lg fs-6 text-decoration-none col-6 py-3 m-0 rounded-0" data-bs-dismiss="modal">Close</button>
										</div>
									</div>
								</div>
							</div>

							<div class="modal fade" tabindex="-1" id="{{ meeting.id|trim('1234567890', 'left')|lower }}-delete-modal">
								<div class="modal-dialog" role="document">
									<div class="modal-content rounded-3 shadow">
										<div class="modal-body p-4 text-center">
											<h5 class="mb-0" id="{{ meeting.id|trim('1234567890', 'left')|lower }}-delete-modal">Delete
												{{ meeting.name }}</h5>
											<p class="mb-0">Are you sure you want to delete this transcription?</p>
										</div>
										<div class="modal-footer flex-nowrap p-0">
											<a class="btn btn-lg btn-danger fs-6 text-decoration-none col-6 py-3 m-0 rounded-0 fw-bold border-end" data-bs-dismiss="modal" href="{{ path('app_dashboard_transcriptions_delete', {transcriptionId: meeting.id}) }}">Yes, delete</a>
											<button type="button" class="btn btn-lg fs-6 text-decoration-none col-6 py-3 m-0 rounded-0" data-bs-dismiss="modal">Cancel</button>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="modal fade" tabindex="-1" id="{{ meeting.id|trim('1234567890', 'left')|lower }}-end-modal">
							<div class="modal-dialog" role="document">
								<div class="modal-content rounded-3 shadow">
									<div class="modal-body p-4 text-center">
										<h5 class="mb-0" id="{{ meeting.id|trim('1234567890', 'left')|lower }}-end-modal">End transcription
											{{ meeting.name }}</h5>
										<p class="mb-0">Are you sure you want to end this transcription?</p>
									</div>
									<div class="modal-footer flex-nowrap p-0">
										<a class="btn btn-lg btn-danger fs-6 text-decoration-none col-6 py-3 m-0 rounded-0 fw-bold border-end" data-bs-dismiss="modal" href="{{ path('app_dashboard_transcriptions_end', {transcriptionId: meeting.id}) }}">Yes, end</a>
										<button type="button" class="btn btn-lg fs-6 text-decoration-none col-6 py-3 m-0 rounded-0" data-bs-dismiss="modal">Cancel</button>
									</div>
								</div>
							</div>
						</div>
					{% endfor %}


				{% else %}

					<div class="d-flex justify-content-center align-items-center h-100 mt-3">

						<div>
							<h2>Welcome to ReadTheVoice!</h2>

							<p>Start using ReadTheVoice by creating your first transcription.</p>

							<a class="btn btn-primary py-2" href="{{ path("app_dashboard_create_transcription") }}">Create my first transcription</a>
						</div>

					{% endif %}
				</div>
			</div>
		</div>
	{% endblock %}
